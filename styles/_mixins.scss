@use './variables' as *;
@use "sass:string" as *;
@use "sass:math" as *;
@use "sass:color" as *;
@use "sass:meta" as *;
@use 'sass:map' as map;

/* ---------- MEDIA MIXINS ----------
@mixin mobile {
  @media screen and (max-width: 768px) {
    @content;
  }
}

@mixin tablet {
  @media screen and (max-width: 1024px) {
    @content;
  }
}

@mixin desktop {
  @media screen and (min-width: 1025px) {
    @content;
  }
}
*/

@function to-rgba($var, $opacity: 1) {
  @if $opacity > 1 {
    $opacity: $opacity / 100;
  }
  @return unquote("rgb(var(#{$var}) / #{$opacity * 100}%)");
}

@function to-rgb($hex) {
  @if type-of($hex) != "color" {
    @warn "⚠️ to-rgb(): expected a color, got `#{$hex}`. Returning as-is.";
    @return $hex;
  }

  $r: channel($hex, "red", $space: rgb);
  $g: channel($hex, "green", $space: rgb);
  $b: channel($hex, "blue", $space: rgb);

  @return rgb($r, $g, $b);
}

/* ---------- MEDIA MIXINS UPDATED ---------- */
@mixin mobile-s {
  @media screen and (max-width: 480px) {
    @content;
  }
}

@mixin mobile {
  @media screen and (max-width: 767px) {
    @content;
  }
}

@mixin tablet {
  @media screen and (max-width: 1023px) {
    @content;
  }
}

@mixin tablet-lg {
  @media screen and (max-width: 1279px) {
    @content;
  }
}

@mixin desktop {
  @media screen and (max-width: 1439px) {
    @content;
  }
}

@mixin desktop-lg {
  @media screen and (min-width: 1440px) {
    @content;
  }
}

/* ---------- LAYOUT MIXINS ---------- */
@mixin responsive-container($calculated: 0px) {
  width: 100%;
  max-width: calc(1440px - #{$calculated});
  padding-inline: 64px;
  margin-left: auto;
  margin-right: auto;

  @include tablet-lg() {
    padding-inline: 24px;
  }

  @include mobile() {
    padding-inline: 16px;
  }
}

/* ---------- BUTTON MIXINS ---------- */
%button-shared-layout {
  display: flex;
  width: fit-content;
  align-items: center;
  justify-content: center;
  padding: 8px 24px;
  text-align: center;
  font-weight: 500;
  gap: 16px;
  cursor: pointer;
  border: none;
  border-radius: $radius-button;
  transition: all 0.3s ease-in-out;
}

$btn-variants: (
  'primary': (
    'border': none,
    'border-hover': none,
    'border-active': none,
    'bg': $color-button-primary-default,
    'color': $color-button-text-stroke-reverse,
    'bg-hover': $color-button-primary-hover,
    'color-hover': $color-button-text-stroke-reverse,
    'bg-active': $color-button-primary-press,
    'color-active': $color-button-text-stroke-reverse,
    'focus-visible': (0 0 0 1px $color-focus-reversed, 0 0 0 3px $color-focus-default)
  ),
  'secondary': (
    'border': none,
    'border-hover': none,
    'border-active': none,
    'bg': $color-button-secondary-default,
    'color': $color-button-text-stroke-default,
    'bg-hover': $color-button-secondary-hover,
    'color-hover': $color-button-text-stroke-hover,
    'bg-active': $color-button-secondary-press,
    'color-active': $color-button-text-stroke-press,
    'focus-visible': (0 0 0 1px $color-focus-reversed, 0 0 0 3px $color-focus-default)
  ),
  'outlined': (
    'border': $stroke-button solid $color-button-text-stroke-default,
    'border-hover': $stroke-button solid $color-button-text-stroke-hover,
    'border-active': $stroke-button solid $color-button-text-stroke-press,
    'bg': $color-button-outlined-default,
    'color': $color-button-text-stroke-default,
    'bg-hover': $color-button-outlined-hover,
    'color-hover': $color-button-text-stroke-hover,
    'bg-active': $color-button-outlined-press,
    'color-active': $color-button-text-stroke-press,
    'focus-visible': (0 0 0 1px $color-focus-reversed, 0 0 0 3px $color-focus-default)
  ),
  'outlined-reverse': (
    'border': $stroke-button solid $color-button-text-stroke-reverse,
    'border-hover': $stroke-button solid $color-button-text-stroke-reverse,
    'border-active': $stroke-button solid $color-button-text-stroke-reverse,
    'bg': $color-button-outlined-reverse-default,
    'color': $color-button-text-stroke-reverse,
    'bg-hover': $color-button-outlined-reverse-hover,
    'color-hover': $color-button-text-stroke-reverse,
    'bg-active': $color-button-outlined-reverse-press,
    'color-active': $color-button-text-stroke-reverse,
    'focus-visible': (0 0 0 2px $color-focus-default, 0 0 0 3px $color-focus-reversed)
  ),
  'white': (
    'border': none,
    'border-hover': none,
    'border-active': none,
    'bg': $color-button-white-default,
    'color': $color-button-text-stroke-default,
    'bg-hover': $color-button-white-hover,
    'color-hover': $color-button-text-stroke-hover,
    'bg-active': $color-button-white-press,
    'color-active': $color-button-text-stroke-press,
    'focus-visible': (0 0 0 2px $color-focus-default, 0 0 0 3px $color-focus-reversed)
  ),
);

@mixin button($variant: 'primary', $font-size: 16px, $line-height: 24px, $min-width: 150px) {
  @extend %button-shared-layout;

  font-size: $font-size;
  line-height: $line-height;
  min-width: $min-width;

  @if not map.has-key($btn-variants, $variant) {
    @debug "Variant '#{$variant}' not found. Falling back to 'primary'.";
    $variant: 'primary';
  }

  $theme: map.get($btn-variants, $variant);

  border: map.get($theme, 'border');
  background-color: map.get($theme, 'bg');
  color: map.get($theme, 'color');

  &:hover {
    border: map.get($theme, 'border-hover');
    background-color: map.get($theme, 'bg-hover');
    color: map.get($theme, 'color-hover');
  }

  &:active {
    border: map.get($theme, 'border-active');
    background-color: map.get($theme, 'bg-active');
    color: map.get($theme, 'color-active');
  }

  &:focus-visible {
    outline: none;
    box-shadow: map.get($theme, 'focus-visible');
  }
}